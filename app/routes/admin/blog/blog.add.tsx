import { Form, redirect, useActionData, type ActionFunctionArgs } from "react-router";
import { useState } from "react";
import { blogService } from "~/services/blogService";
import { v4 as uuidv4 } from "uuid";
import { Minus, Image as ImageIcon, Check, Search, X } from "lucide-react";
import MarkdownEditor from "~/components/MarkdownEditor";

/**
 * SERVER ACTION
 * จัดการการรับค่าจาก Form และบันทึกลง Database
 */
export const action = async ({ request }: ActionFunctionArgs) => {
  const formData = await request.formData();

  const title = formData.get("title")?.toString() || "";
  const slug = formData.get("slug")?.toString() || "";
  const tags = formData.get("tags")?.toString() || "";
  const author = formData.get("author")?.toString() || "";
  const content = formData.get("content")?.toString() || "";

  // รับค่ารูปภาพจาก Hidden Input (JSON String)
  const imagesJSON = formData.get("imagesJSON")?.toString() || "[]";
  let images = [];
  try {
    images = JSON.parse(imagesJSON);
  } catch (e) {
    images = [];
  }

  if (!title || !slug || !content) {
    return { error: "กรุณากรอกข้อมูล Title, Slug และ Content ให้ครบถ้วน" };
  }

  const newBlog = {
    title,
    slug,
    tags,
    author,
    content,
    images, // Array of image URLs
    date: new Date().toISOString().split("T")[0],
  };

  try {
    await blogService.createMultiple([
  {
    "slug": "condo-selling-options-nextflip-estate",
    "title": "ขายคอนโดได้หลายทาง เลือกแบบไหนดี? NextFlip Estate มีคำตอบ",
    "date": "December 31, 2025",
    "author": "NextFlip Estate",
    "tags": "NextFlip Estate, ขายคอนโด, รับซื้อคอนโด, ฟลิปคอนโด, อสังหาริมทรัพย์",
    "images": [
      "/images/condo24.jpg",
      "/images/condo25.jpg",
      "/images/condo26.jpg"
    ],
    "content": "# ขายคอนโดได้หลายทาง เลือกแบบไหนดี? NextFlip Estate มีคำตอบ\n\n*วันที่ 31 ธันวาคม 2025*\n*โดย NextFlip Estate*\n\nการขายคอนโดในยุคปัจจุบันไม่ใช่เรื่องง่าย หลายคนเจอปัญหาขายไม่ออก ราคาไม่ตรงใจ หรือต้องรอนานเกินไป แต่คุณรู้ไหมว่าจริงๆ แล้ว **การขายคอนโดมีหลายทางเลือก** และแต่ละทางก็เหมาะกับสถานการณ์ที่ต่างกัน\n\n## ทำไมต้อง NextFlip Estate?\n\n**ทีมงาน NextFlip Estate เข้าใจว่าการขายคอนโดของแต่ละคนมีเงื่อนไขไม่เหมือนกัน** บางกรณีต้องการขายเร็วด้วยการรับซื้อเงินสด บางกรณีสามารถวางแผนในรูปแบบฟลิปหรือแนวทางอื่น เพื่อเพิ่มโอกาสได้ราคาที่สูงขึ้น\n\nเราประเมินตามสภาพจริง อธิบายแต่ละทางเลือกอย่างตรงไปตรงมา เพื่อให้คุณตัดสินใจได้บนข้อมูลที่ครบถ้วนและเหมาะกับคุณที่สุด\n\n## 3 ทางเลือกในการขายคอนโด\n\n### 1. รับซื้อเงินสดทันที - เหมาะกับคนต้องการความรวดเร็ว\n\nถ้าคุณต้องการเงินด่วน หรือไม่อยากรอ การรับซื้อเงินสดคือทางเลือกที่ดีที่สุด เราประเมินราคายุติธรรมตามสภาพห้องจริง และสามารถโอนเงินได้ภายในไม่กี่วัน\n\n**ข้อดี:**\n* ได้เงินเร็ว ไม่ต้องรอหาผู้ซื้อ\n* ไม่ต้องจัดการเรื่องซ่อมแซมหรือตกแต่ง\n* ประหยัดเวลาและค่าใช้จ่ายส่วนกลาง\n\n### 2. ฟลิปคอนโด - เพิ่มมูลค่าก่อนขาย\n\nหากคอนโดของคุณมีศักยภาพแต่สภาพยังไม่ดีพอ การ **\"ฟลิป\"** หรือปรับปรุงก่อนขายอาจทำให้คุณได้ราคาที่สูงกว่ามาก\n\n### 3. วางขายแบบมืออาชีพ - ให้เราช่วยหาผู้ซื้อที่เหมาะสม\n\nบางครั้งคอนโดของคุณอยู่ในสภาพดีแล้ว แค่ต้องการคนที่เข้าใจตลาดมาช่วยหาผู้ซื้อที่เหมาะสม\n\n> \"การลงทุนคอนโดไม่ใช่แค่เรื่องของราคา แต่เป็นเรื่องของทำเลและโอกาส\"\n\n---\n\n*NextFlip Estate - ขายคอนโดได้หลายทาง เลือกแบบที่เหมาะกับคุณ*"
  },
  {
    "slug": "condo-flip-bangkok-guide-2025",
    "title": "คู่มือฟลิปคอนโดกรุงเทพฯ 2025: เพิ่มมูลค่าห้องคุณอย่างมืออาชีพ",
    "date": "December 30, 2025",
    "author": "NextFlip Estate",
    "tags": "ฟลิปคอนโด, ปรับปรุงคอนโด, เพิ่มมูลค่าคอนโด, NextFlip Estate, ลงทุนอสังหาริมทรัพย์",
    "images": [
      "/images/condo24.jpg",
      "/images/condo25.jpg",
      "/images/condo26.jpg"
    ],
    "content": "# คู่มือฟลิปคอนโดกรุงเทพฯ 2025: เพิ่มมูลค่าห้องคุณอย่างมืออาชีพ\n\n*วันที่ 30 ธันวาคม 2025*\n*โดย NextFlip Estate*\n\nการ **ฟลิปคอนโด** หรือการปรับปรุงคอนโดก่อนขายเป็นกลยุทธ์ที่นักลงทุนอสังหาริมทรัพย์มืออาชีพใช้เพื่อเพิ่มมูลค่าของทรัพย์สินได้อย่างมีประสิทธิภาพ แต่การฟลิปที่ประสบความสำเร็จนั้นต้องอาศัยความรู้ ประสบการณ์ และการวางแผนที่ดี\n\n## ฟลิปคอนโดคืออะไร?\n\nฟลิปคอนโดคือการซื้อคอนโดที่มีสภาพไม่ดีหรือต่ำกว่ามาตรฐาน แล้วนำมาปรับปรุงตกแต่งใหม่ให้ดูทันสมัย สะอาด และน่าอยู่มากขึ้น จากนั้นจึงนำออกขายในราคาที่สูงกว่าเดิม\n\n> \"การฟลิปที่ดีไม่ใช่แค่การทาสีใหม่ แต่คือการเข้าใจความต้องการของตลาดและผู้ซื้อ\"\n\n## ทำไมต้องฟลิปคอนโด?\n\n### ข้อดีของการฟลิปคอนโด:\n\n* **เพิ่มมูลค่าได้มาก** - คอนโดที่ฟลิปดีสามารถขายได้สูงกว่าราคาเดิม 20-40%\n* **ขายได้เร็วขึ้น** - คอนโดที่สภาพดีและทันสมัยดึงดูดผู้ซื้อได้ง่ายกว่า\n* **แข่งขันได้ในตลาด** - โดดเด่นกว่าคอนโดอื่นๆ ที่ขายในราคาใกล้เคียงกัน\n* **ลดเวลาขาย** - ผู้ซื้อตัดสินใจเร็วขึ้นเมื่อเห็นห้องที่พร้อมอยู่\n\n## 5 ขั้นตอนการฟลิปคอนโดให้ประสบความสำเร็จ\n\n### 1. ประเมินศักยภาพและงบประมาณ\n\nก่อนเริ่มฟลิป ต้องรู้ว่า:\n* คอนโดนี้มีศักยภาพในการเพิ่มมูลค่าหรือไม่?\n* ทำเลดีพอหรือเปล่า?\n* งบประมาณที่ต้องลงทุนเท่าไหร่?\n* คาดว่าจะขายได้ในราคาเท่าไหร่?\n\n**ทีม NextFlip Estate ช่วยประเมินฟรี** เพื่อบอกว่าคอนโดของคุณควรฟลิปหรือไม่\n\n### 2. วางแผนการปรับปรุง\n\nจุดสำคัญของการฟลิปคือ **ทำสิ่งที่คุ้มค่าที่สุด** ไม่ใช่ทำทุกอย่าง\n\n**สิ่งที่ควรปรับปรุงเสมอ:**\n* ห้องครัวและห้องน้ำ - จุดที่ผู้ซื้อให้ความสำคัญมากที่สุด\n* สีผนังและพื้น - สร้างความรู้สึกสะอาดและทันสมัย\n* แสงสว่าง - เปลี่ยนโคมไฟให้ทันสมัยและเพิ่มแสงธรรมชาติ\n* ระบบปรับอากาศ - ทำความสะอาดหรือเปลี่ยนใหม่\n\n**สิ่งที่ไม่ควรลงทุนมาก:**\n* เฟอร์นิเจอร์แพงๆ - ส่วนใหญ่ผู้ซื้อต้องการตกแต่งเอง\n* งานโครงสร้างใหญ่ - ถ้าไม่จำเป็น อาจไม่คุ้มค่า\n* ของตกแต่งฟุ่มเฟือย - ความเรียบง่ายและทันสมัยดีกว่า\n\n### 3. จ้างผู้รับเหมาที่เชื่อถือได้\n\nการเลือกผู้รับเหมาที่ดีมีความสำคัญมาก เพราะจะช่วย:\n* ทำงานได้ตรงเวลา\n* ควบคุมงบประมาณ\n* คุณภาพงานดี ไม่ต้องกลับมาแก้ไข\n\n**NextFlip Estate มีเครือข่ายผู้รับเหมาที่ไว้ใจได้** พร้อมควบคุมคุณภาพให้คุณ\n\n### 4. ถ่ายภาพและจัดแสดงอย่างมืออาชีพ\n\nหลังจากฟลิปเสร็จ ภาพถ่ายมืออาชีพคือสิ่งสำคัญที่จะทำให้คอนโดของคุณโดดเด่น:\n* จ้างช่างภาพมืออาชีพ\n* ถ่ายในช่วงเวลาที่แสงสวย\n* จัด Staging ให้ห้องดูอบอุ่นและน่าอยู่\n\n### 5. กำหนดราคาและการตลาดที่ถูกต้อง\n\nการกำหนดราคาที่เหมาะสมและการตลาดที่ดีจะช่วยให้:\n* ขายได้เร็ว\n* ได้ราคาตามที่ตั้งเป้าไว้\n* เข้าถึงผู้ซื้อที่เหมาะสม\n\n## เทรนด์การฟลิปคอนโดปี 2025\n\nผู้ซื้อในปี 2025 ให้ความสำคัญกับ:\n\n* **Minimalist Design** - การออกแบบที่เรียบง่าย สะอาดตา ใช้งานได้จริง\n* **Smart Home Features** - ระบบควบคุมแสง ปรับอากาศ ผ่านมือถือ\n* **Sustainable Materials** - วัสดุที่เป็นมิตรกับสิ่งแวดล้อม\n* **Work from Home Space** - พื้นที่ทำงานที่แยกออกมาชัดเจน\n* **Storage Solutions** - ที่เก็บของที่ชาญฉลาดและประหยัดพื้นที่\n\n## ข้อผิดพลาดที่ควรหลีกเลี่ยง\n\n### 1. Over-Improvement\nการลงทุนมากเกินไปจนราคาขายสูงเกินกว่าตลาดจะรับได้\n\n### 2. ประมาณการงบผิดพลาด\nต้องมีเงินสำรองอย่างน้อย 15-20% ของงบฟลิป\n\n### 3. ไม่ศึกษาตลาด\nต้องรู้ว่าคอนโดในทำเลนี้ขายได้ในราคาประมาณเท่าไหร่\n\n### 4. เลือกช่างงานที่ถูกที่สุด\nบางครั้งถูกกว่า แต่คุณภาพไม่ดี ต้องกลับมาแก้ไขใหม่\n\n## NextFlip Estate ช่วยคุณฟลิปอย่างไร?\n\nเรามีบริการครบวงจรสำหรับการฟลิปคอนโด:\n\n* **ประเมินศักยภาพฟรี** - บอกว่าคอนโดคุณควรฟลิปหรือไม่\n* **วางแผนงบประมาณ** - คำนวณค่าใช้จ่ายและผลตอบแทนที่คาดหวัง\n* **จัดหาผู้รับเหมา** - เครือข่ายช่างที่เชื่อถือได้\n* **ควบคุมคุณภาพงาน** - ตรวจสอบงานทุกขั้นตอน\n* **การตลาดและขาย** - ถ่ายภาพมืออาชีพ โฆษณา และหาผู้ซื้อ\n* **ดูแลจนโอนกรรมสิทธิ์** - จัดการเอกสารและขั้นตอนการโอน\n\n## ตัวอย่างความสำเร็จ\n\n**Case Study: คอนโดสุขุมวิท 1 ห้องนอน**\n* ราคาซื้อ: 2.5 ล้านบาท\n* ค่าฟลิป: 300,000 บาท\n* ราคาขาย: 3.3 ล้านบาท\n* กำไร: 500,000 บาท (16.7%)\n* ระยะเวลา: 3 เดือน\n\n## สรุป\n\nการฟลิปคอนโดเป็นโอกาสในการเพิ่มมูลค่าทรัพย์สินได้อย่างมีประสิทธิภาพ แต่ต้องอาศัยความรู้ ประสบการณ์ และการวางแผนที่ดี หากคุณกำลังคิดจะฟลิปคอนโด NextFlip Estate พร้อมเป็นพาร์ทเนอร์ที่จะช่วยให้คุณประสบความสำเร็จ\n\nติดต่อเราวันนี้เพื่อรับคำปรึกษาฟรี และเริ่มต้นการฟลิปคอนโดของคุณ!\n\n---\n\n*NextFlip Estate - ฟลิปคอนโดอย่างมืออาชีพ เพิ่มมูลค่าได้จริง*"
  },
  {
    "slug": "sell-condo-fast-cash-bangkok",
    "title": "ขายคอนโดด่วน รับเงินสดทันที กับ NextFlip Estate - ไม่ต้องรอ ไม่ต้องซ่อม",
    "date": "December 29, 2025",
    "author": "NextFlip Estate",
    "tags": "ขายคอนโดด่วน, รับซื้อคอนโดเงินสด, ขายคอนโดเร็ว, NextFlip Estate, อสังหาริมทรัพย์",
    "images": [
      "/images/condo24.jpg",
      "/images/condo25.jpg",
      "/images/condo26.jpg"
    ],
    "content": "# ขายคอนโดด่วน รับเงินสดทันที กับ NextFlip Estate - ไม่ต้องรอ ไม่ต้องซ่อม\n\n*วันที่ 29 ธันวาคม 2025*\n*โดย NextFlip Estate*\n\nบางครั้งในชีวิต เราต้องการเงินด่วน หรือต้องการขายคอนโดอย่างเร่งด่วน ไม่ว่าจะเป็นเพื่อนำเงินไปใช้ลงทุนในโอกาสใหม่ แก้ปัญหาทางการเงิน หรือเพียงแค่ไม่อยากจ่ายค่าส่วนกลางอีกต่อไป\n\n**NextFlip Estate** มีทางออกที่ตรงไปตรงมาสำหรับคุณ - **รับซื้อคอนโดเงินสดทันที**\n\n## ทำไมต้องเลือกขายแบบรับเงินสดทันที?\n\nการขายคอนโดแบบปกติอาจใช้เวลาหลายเดือนหรือแม้กระทั่งปี แต่บางครั้งคุณไม่มีเวลารอ\n\n### สถานการณ์ที่เหมาะกับการขายแบบรับเงินสดทันที:\n\n* **ต้องการเงินด่วน** - มีโอกาสการลงทุนใหม่ หรือต้องนำเงินไปใช้เร่งด่วน\n* **ย้ายไปต่างประเทศ** - ไม่สามารถดูแลทรัพย์สินในไทยได้\n* **ไม่อยากจ่ายค่าส่วนกลาง** - ค่าใช้จ่ายรายเดือนที่สะสมขึ้นเรื่อยๆ\n* **คอนโดสภาพไม่ดี** - ไม่อยากลงทุนซ่อมแซม\n* **ติดภาระหนี้** - ต้องการปิดบัญชีเงินกู้\n* **ได้มรดกที่ไม่ต้องการ** - มีคอนโดที่ไม่ได้ใช้ประโยชน์\n\n> \"บางครั้งการได้เงินเร็วสำคัญกว่าการได้เงินเยอะ - ขึ้นอยู่กับสถานการณ์ของแต่ละคน\"\n\n## ข้อดีของการขายแบบรับเงินสดทันที\n\n### 1. ความรวดเร็ว\n* **ประเมินราคาภายใน 24 ชั่วโมง**\n* **รับเงินได้ภายใน 7-14 วัน**\n* **ไม่ต้องรอหาผู้ซื้อ**\n\n### 2. ความแน่นอน\n* **ไม่มีการต่อรองราคาซ้ำซาก**\n* **ไม่มีความเสี่ยงที่ดีลจะตก**\n* **รับเงินจริง ไม่ใช่แค่สัญญา**\n\n### 3. ไม่ต้องลงทุนเพิ่ม\n* **ไม่ต้องซ่อมแซม** - รับซื้อทุกสภาพ\n* **ไม่ต้องทำความสะอาด** - เราดูแลให้\n* **ไม่ต้องจัด Staging** - ไม่จำเป็นต้องตกแต่งให้สวย\n\n### 4. ประหยัดเวลาและค่าใช้จ่าย\n* **ไม่ต้องจ่ายค่าส่วนกลางเพิ่ม** - ขายได้เร็ว จ่ายน้อยลง\n* **ไม่ต้องนัดชมบ่อยๆ** - ไม่เสียเวลาต้อนรับลูกค้า\n* **ไม่ต้องจ่ายค่านายหน้า** - เราซื้อเอง ไม่ผ่านตัวกลาง\n\n## ขั้นตอนการขายแบบรับเงินสดกับ NextFlip Estate\n\n### ขั้นตอนที่ 1: ติดต่อเรา\nโทรมาหรือกรอกฟอร์มออนไลน์ บอกรายละเอียดคอนโดของคุณ\n\n### ขั้นตอนที่ 2: ประเมินราคา\nทีมงานจะนัดหมายเพื่อไปดูห้องจริง และประเมินราคา (ภายใน 24 ชั่วโมง)\n\n### ขั้นตอนที่ 3: เสนอราคา\nเราเสนอราคาที่ยุติธรรม ตรงไปตรงมา พร้อมอธิบายเหตุผล\n\n### ขั้นตอนที่ 4: ตกลงราคา\nถ้าคุณพอใจ เราดำเนินการต่อทันที\n\n### ขั้นตอนที่ 5: จัดการเอกสาร\nเราช่วยจัดการเอกสารและขั้นตอนทางกฎหมายทั้งหมด\n\n### ขั้นตอนที่ 6: รับเงิน\nโอนเงินเข้าบัญชีของคุณภายใน 7-14 วัน\n\n## เรารับซื้อคอนโดทุกสภาพ\n\n**ไม่ว่าคอนโดของคุณจะ:**\n* สภาพเก่า ต้องซ่อมแซมมาก\n* ผู้เช่าอยู่ ยังคงเช่าอยู่\n* ติดจำนอง ยังมีภาระหนี้ค้างอยู่\n* ขนาดเล็กหรือขนาดใหญ่\n* อยู่ในทำเลไหนก็ได้ในกรุงเทพฯ และปริมณฑล\n\n**เรารับซื้อทั้งหมด!**\n\n## เปรียบเทียบ: ขายเอง vs ขายให้ NextFlip Estate\n\n**การขายเอง:**\n* ใช้เวลา: 3-12 เดือน\n* ต้องลงทุนซ่อมแซม: 50,000-300,000 บาท\n* ต้องจ่ายค่าส่วนกลาง: 3,000-10,000 บาท/เดือน\n* ต้องนัดชมบ่อยๆ: เสียเวลาและความเป็นส่วนตัว\n* ความไม่แน่นอน: ดีลอาจตกได้\n\n**ขายให้ NextFlip Estate:**\n* ใช้เวลา: 7-14 วัน\n* ไม่ต้องลงทุนเพิ่ม: 0 บาท\n* จ่ายค่าส่วนกลาง: แค่เดือนสุดท้าย\n* ไม่ต้องนัดชม: แค่ครั้งเดียวตอนประเมิน\n* แน่นอน 100%: ราคาที่เสนอคือราคาจริง\n\n## คำถามที่พบบ่อย\n\n### ราคาจะต่ำกว่าราคาตลาดมากไหม?\nราคาที่เราเสนอจะยุติธรรมตามสภาพจริงของห้อง เราพิจารณาจากหลายปัจจัย เช่น สภาพห้อง ทำเล ราคาตลาดปัจจุบัน และเราอธิบายเหตุผลอย่างโปร่งใส\n\n### ถ้าคอนโดยังมีเงินกู้ค้างอยู่ ขายได้ไหม?\nได้ครับ เราช่วยจัดการเรื่องการปิดบัญชีเงินกู้ให้\n\n### ต้องเตรียมอะไรบ้าง?\nเอกสารสิทธิ์ (โฉนด) บัตรประชาชน และสมุดบัญชี ส่วนเรื่องอื่นๆ เราช่วยจัดการให้\n\n### ถ้าผู้เช่ายังอยู่ ขายได้ไหม?\nได้ครับ เรารับซื้อแม้จะมีผู้เช่าอยู่ เราจะจัดการเรื่องนี้ให้\n\n## ทำไมต้อง NextFlip Estate?\n\nเราไม่ได้เป็นแค่นักลงทุนที่มองหากำไรเท่านั้น แต่เราเป็น**พาร์ทเนอร์ที่เข้าใจสถานการณ์ของคุณ**\n\n* **ประสบการณ์มากกว่า 10 ปี** ในตลาดอสังหาริมทรัพย์\n* **ซื้อคอนโดมาแล้วกว่า 200 ยูนิต**\n* **ชื่อเสียงดี เชื่อถือได้** - ตรวจสอบได้จากรีวิวลูกค้า\n* **ราคายุติธรรม โปร่งใส** - อธิบายเหตุผลทุกอย่าง\n* **ดำเนินการรวดเร็ว** - ได้เงินจริงภายใน 2 สัปดาห์\n\n## เริ่มต้นขายคอนโดของคุณวันนี้\n\nถ้าคุณต้องการขายคอนโดอย่างรวดเร็ว ไม่อยากรอ ไม่อยากลงทุนซ่อมแซม NextFlip Estate คือคำตอบของคุณ\n\n**ติดต่อเราวันนี้เพื่อ:**\n* รับการประเมินราคาฟรี ภายใน 24 ชั่วโมง\n* ปรึกษาเรื่องการขายโดยไม่มีค่าใช้จ่าย\n* รับข้อเสนอราคาที่ยุติธรรมและโปร่งใส\n\nไม่ว่าคุณจะตัดสินใจขายหรือไม่ เราก็ยินดีให้คำปรึกษา เพราะเราเชื่อว่าทุกคนควรได้รับข้อมูลที่ดีก่อนตัดสินใจ\n\n---\n\n*NextFlip Estate - รับซื้อคอนโดเงินสด รวดเร็ว แน่นอน ไว้ใจได้*"
  },
  {
    "slug": "bangkok-condo-investment-guide-2025",
    "title": "คู่มือลงทุนคอนโดกรุงเทพฯ 2025: ทำเล เทรนด์ และกลยุทธ์ที่ต้องรู้",
    "date": "December 28, 2025",
    "author": "NextFlip Estate",
    "tags": "ลงทุนคอนโด, คอนโดกรุงเทพ, ทำเลดี, NextFlip Estate, อสังหาริมทรัพย์",
    "images": [
      "/images/condo24.jpg",
      "/images/condo25.jpg",
      "/images/condo26.jpg"
    ],
    "content": "# คู่มือลงทุนคอนโดกรุงเทพฯ 2025: ทำเล เทรนด์ และกลยุทธ์ที่ต้องรู้\n\n*วันที่ 28 ธันวาคม 2025*\n*โดย NextFlip Estate*\n\nการลงทุนคอนโดในกรุงเทพฯ ยังคงเป็นหนึ่งในช่องทางการลงทุนที่น่าสนใจ แต่ตลาดในปี 2025 มีการเปลี่ยนแปลงไปจากเดิมมาก นักลงทุนที่ประสบความสำเร็จคือคนที่เข้าใจเทรนด์ใหม่และปรับกลยุทธ์ให้เหมาะสม\n\n## ภาพรวมตลาดคอนโดกรุงเทพฯ 2025\n\nตลาดคอนโดในปี 2025 มีลักษณะพิเศษดังนี้:\n\n* **ความต้องการเปลี่ยนไป** - ผู้ซื้อให้ความสำคัญกับคุณภาพชีวิตมากกว่าแค่ราคา\n* **Work from Home ยังคงมีอิทธิพล** - ต้องมีพื้นที่ทำงานที่บ้าน\n* **สิ่งแวดล้อมเป็นสิ่งสำคัญ** - พื้นที่สีเขียว อากาศดี เป็นจุดขาย\n* **เทคโนโลยี Smart Home** - กลายเป็นสิ่งจำเป็นมากกว่าฟีเจอร์พิเศษ\n* **การเดินทางที่สะดวก** - ใกล้รถไฟฟ้ายังคงสำคัญ\n\n> \"การลงทุนคอนโดที่ประสบความสำเร็จในปี 2025 ต้องมองเห็นความต้องการที่เปลี่ยนไปของผู้อยู่อาศัย\"\n\n## 5 ทำเลยอดนิยมในกรุงเทพฯ 2025\n\n### 1. สุขุมวิท - ใจกลางเมืองที่ไม่มีวันเสื่อม\n\n**ทำไมน่าลงทุน:**\n* เป็นย่านธุรกิจหลักของกรุงเทพฯ\n* ใกล้รถไฟฟ้า BTS และ MRT\n* ร้านอาหาร ห้างสรรพสินค้า ครบครัน\n* ผู้เช่าต่างชาติเยอะ - รายได้ค่าเช่าสูง\n\n**ราคาเฉลี่ย:** 150,000-300,000 บาท/ตร.ม.\n**ผลตอบแทนค่าเช่า:** 4-5% ต่อปี\n**เหมาะกับ:** นักลงทุนที่มีเงินทุนสูง ต้องการผลตอบแทนมั่นคง\n\n### 2. รัชดา-พระราม 9 - CBD ใหม่ที่กำลังเติบโต\n\n**ทำไมน่าลงทุน:**\n* ศูนย์กลางธุรกิจใหม่\n* MRT เชื่อมต่อได้หลายสาย\n* ราคายังไม่แพงเกินไปเมื่อเทียบกับสุขุมวิท\n* มีโครงการพัฒนาเมืองใหม่มากมาย\n\n**ราคาเฉลี่ย:** 100,000-180,000 บาท/ตร.ม.\n**ผลตอบแทนค่าเช่า:** 4.5-6% ต่อปี\n**เหมาะกับ:** นักลงทุนที่มองหาราคาที่เหมาะสม และศักยภาพการเติบโต\n\n### 3. ลาดพร้าว-รามอินทรา - พื้นที่อยู่อาศัยที่น่าสนใจ\n\n**ทำไมน่าลงทุน:**\n* ราคาสมเหตุสมผล\n* ใกล้ MRT สายสีเหลือง\n* ชุมชนเป็นกันเอง เหมาะกับครอบครัว\n* มีสิ่งอำนวยความสะดวกครบครัน\n\n**ราคาเฉลี่ย:** 70,000-120,000 บาท/ตร.ม.\n**ผลตอบแทนค่าเช่า:** 5-6.5% ต่อปี\n**เหมาะกับ:** นักลงทุนมือใหม่ หรือคนที่มีเงินทุนจำกัด\n\n### 4. ทองหล่อ-เอกมัย - ย่านไฮโซที่มีเสน่ห์\n\n**ทำไมน่าลงทุน:**\n* ย่านหรู มีคาเฟ่ ร้านอาหาร high-end\n* ผู้เช่ากำลังซื้อสูง\n* ชุมชนชาวต่างชาติ Expat เยอะ\n* มูลค่าคงที่ ไม่ลดง่าย\n\n**ราคาเฉลี่ย:** 180,000-350,000 บาท/ตร.ม.\n**ผลตอบแทนค่าเช่า:** 3.5-4.5% ต่อปี\n**เหมาะกับ:** นักลงทุนที่มองหามูลค่าทรัพย์สินที่มั่นคง\n\n### 5. สาทร-สีลม - ใจกลางธุรกิจการเงิน\n\n**ทำไมน่าลงทุน:**\n* ศูนย์กลางการเงินของประเทศ\n* ใกล้ BTS และ MRT\n* ความต้องการเช่าสูงตลอดปี\n* ผู้เช่าส่วนใหญ่เป็น Professionals\n\n**ราคาเฉลี่ย:** 130,000-250,000 บาท/ตร.ม.\n**ผลตอบแทนค่าเช่า:** 4-5.5% ต่อปี\n**เหมาะกับ:** นักลงทุนที่ต้องการผลตอบแทนมั่นคงจากค่าเช่า\n\n## เทรนด์คอนโดที่ผู้ซื้อต้องการในปี 2025\n\n### 1. Smart Home Technology\nระบบควบคุมแสง ปรับอากาศ ล็อคประตู ผ่านมือถือ\n\n### 2. Co-Working Space\nพื้นที่ทำงานส่วนกลางที่ทันสมัย\n\n### 3. Wellness Amenities\nฟิตเนส โยคะ สระว่ายน้ำ และสวนสุขภาพ\n\n### 4. Sustainable Design\nวัสดุเป็นมิตรกับสิ่งแวดล้อม ระบบประหยัดพลังงาน\n\n### 5. Pet-Friendly\nพื้นที่สำหรับสัตว์เลี้ยง ซึ่งเป็นความต้องการที่เพิ่มขึ้น\n\n## 7 กลยุทธ์การลงทุนคอนโดให้ประสบความสำเร็จ\n\n### กลยุทธ์ที่ 1: ศึกษาทำเลอย่างละเอียด\n\n**สิ่งที่ต้องดู:**\n* ระยะทางจากรถไฟฟ้า (ควรไม่เกิน 500 เมตร)\n* สิ่งอำนวยความสะดวกใกล้เคียง\n* แผนพัฒนาพื้นที่ในอนาคต\n* กลุ่มเป้าหมายผู้เช่าในย่านนั้น\n\n### กลยุทธ์ที่ 2: เลือกโครงการที่ถูกต้อง\n\n**ตรวจสอบ:**\n* ชื่อเสียงของผู้พัฒนา\n* อัตราการเข้าพักของโครงการ\n* ค่าส่วนกลางเทียบกับสิ่งอำนวยความสะดวก\n* นิติบุคคลดูแลดีหรือไม่\n\n### กลยุทธ์ที่ 3: คำนวณผลตอบแทนอย่างถูกต้อง\n\n**ต้องคิด:**\n* ราคาซื้อ + ค่าโอน + ค่าตกแต่ง\n* ค่าส่วนกลาง + ค่าบริการต่างๆ\n* อัตราค่าเช่าจริง (ไม่ใช่อัตราที่โฆษณา)\n* ระยะเวลาที่ห้องว่าง\n\n**สูตรคำนวณง่ายๆ:**\n```\nผลตอบแทน (%) = (ค่าเช่าต่อปี - ค่าใช้จ่ายต่อปี) ÷ ราคาซื้อ × 100\n```\n\n### กลยุทธ์ที่ 4: จังหวะเวลาในการซื้อ\n\n**ช่วงเวลาที่ดี:**\n* ช่วงราคาพิเศษ Pre-sale\n* ช่วง End of Year Sale\n* ซื้อจากเจ้าของที่ต้องการขายด่วน\n\n### กลยุทธ์ที่ 5: แผนการบริหารจัดการ\n\n**ตัดสินใจว่าจะ:**\n* จัดการเอง หรือจ้างบริษัทจัดการ\n* ตกแต่งแบบไหน (Fully Furnished หรือ Unfurnished)\n* กลุ่มเป้าหมายผู้เช่าคือใคร\n\n### กลยุทธ์ที่ 6: เตรียมพร้อมสำหรับปัญหา\n\n**มีเงินสำรอง:**\n* ช่วงห้องว่าง 1-2 เดือน\n* ค่าซ่อมแซมเมื่อผู้เช่าย้ายออก\n* ค่าใช้จ่ายไม่คาดฝัน\n\n### กลยุทธ์ที่ 7: Exit Strategy\n\n**วางแผนตั้งแต่ต้นว่า:**\n* จะถือไว้นานแค่ไหน\n* เมื่อไหร่ควรขาย\n* ราคาเป้าหมายในการขาย\n\n## ข้อผิดพลาดที่ควรหลีกเลี่ยง\n\n### 1. ซื้อเพราะราคาถูกเท่านั้น\nบางครั้งถูกเพราะมีเหตุผล - ทำเลไม่ดี หรือโครงการมีปัญหา\n\n### 2. ไม่คำนวณค่าใช้จ่ายจริง\nต้องคิดค่าส่วนกลาง ภาษี และค่าบริหารจัดการด้วย\n\n### 3. คาดหวังผลตอบแทนสูงเกินจริง\nตลาดปัจจุบัน 4-6% ต่อปีถือว่าดีแล้ว\n\n### 4. ไม่มีเงินสำรอง\nควรมีเงินสำรองอย่างน้อย 6 เดือนของค่าผ่อนและค่าส่วนกลาง\n\n### 5. ซื้อห้องที่ไม่ใช่สต็อกห้องของตลาด\nห้องขนาดแปลกๆ หรือผังห้องไม่ดี จะขายหรือให้เช่ายาก\n\n## NextFlip Estate ช่วยอะไรนักลงทุนได้บ้าง?\n\nเราไม่ได้เป็นแค่ผู้ซื้อขายคอนโด แต่เราเป็น**พาร์ทเนอร์การลงทุน**:\n\n* **วิเคราะห์ทำเล** - ให้ข้อมูลเชิงลึกเกี่ยวกับศักยภาพการเติบโต\n* **คำนวณผลตอบแทน** - วิเคราะห์ ROI ที่เป็นจริง\n* **หาโอกาสการลงทุน** - เรามีคอนโดในสต็อกหลากหลาย\n* **บริการหลังการขาย** - ช่วยหาผู้เช่า บริหารจัดการ\n* **Exit Strategy** - ช่วยขายเมื่อคุณต้องการ\n\n## สรุป\n\nการลงทุนคอนโดในกรุงเทพฯ ปี 2025 ยังคงเป็นโอกาสที่ดี แต่ต้องเลือกทำเล วิเคราะห์อย่างรอบคอบ และมีกลยุทธ์ที่ชัดเจน นักลงทุนที่ประสบความสำเร็จคือคนที่เข้าใจตลาด ทำการบ้าน และพร้อมรับมือกับการเปลี่ยนแปลง\n\nถ้าคุณกำลังมองหาโอกาสในการลงทุนคอนโด NextFlip Estate พร้อมเป็นที่ปรึกษาและพาร์ทเนอร์ที่คุณไว้ใจได้\n\nติดต่อเราวันนี้เพื่อรับคำปรึกษาฟรี และเริ่มต้นการลงทุนที่ประสบความสำเร็จ!\n\n---\n\n*NextFlip Estate - พาร์ทเนอร์การลงทุนอสังหาริมทรัพย์ที่คุณไว้ใจได้*"
  },
  {
    "slug": "condo-renovation-roi-guide",
    "title": "ปรับปรุงคอนโดแบบไหนคุ้ม? คู่มือเพิ่ม ROI ก่อนขายหรือให้เช่า",
    "date": "December 27, 2025",
    "author": "NextFlip Estate",
    "tags": "ปรับปรุงคอนโด, เพิ่มมูลค่าคอนโด, ROI, NextFlip Estate, ฟลิปคอนโด",
    "images": [
      "/images/condo24.jpg",
      "/images/condo25.jpg",
      "/images/condo26.jpg"
    ],
    "content": "# ปรับปรุงคอนโดแบบไหนคุ้ม? คู่มือเพิ่ม ROI ก่อนขายหรือให้เช่า\n\n*วันที่ 27 ธันวาคม 2025*\n*โดย NextFlip Estate*\n\nการปรับปรุงคอนโดก่อนขายหรือให้เช่าอาจทำให้คุณได้ราคาที่สูงขึ้นมาก แต่ไม่ใช่ทุกการปรับปรุงจะคุ้มค่า บางอย่างอาจเสียเงินไปมากแต่ไม่ได้เพิ่มมูลค่าเท่าที่ควร\n\nวันนี้ NextFlip Estate จะมาแชร์ความรู้จากประสบการณ์การฟลิปคอนโดมากกว่า 200 ยูนิต ว่า**ควรปรับปรุงอะไร ไม่ควรปรับปรุงอะไร** เพื่อให้คุณได้ผลตอบแทนสูงสุด\n\n## ROI คืออะไร และทำไมต้องคำนวณ?\n\n**ROI (Return on Investment)** คือผลตอบแทนจากการลงทุน คำนวณจาก:\n\n```\nROI = (กำไรที่เพิ่มขึ้น - ต้นทุนการปรับปรุง) ÷ ต้นทุนการปรับปรุง × 100%\n```\n\n**ตัวอย่าง:**\n* คุณลงทุนปรับปรุงห้องครัว 100,000 บาท\n* คอนโดขายได้เพิ่มขึ้น 180,000 บาท\n* ROI = (180,000 - 100,000) ÷ 100,000 × 100% = 80%\n\n> \"การปรับปรุงที่ดีไม่ใช่การทำทุกอย่างให้สวย แต่คือการทำสิ่งที่ให้ผลตอบแทนสูงสุด\"\n\n## 10 การปรับปรุงที่คุ้มค่าที่สุด (เรียงตาม ROI)\n\n### 1. ทาสีใหม่ทั้งห้อง - ROI สูงสุด 300-500%\n\n**ต้นทุน:** 15,000-30,000 บาท\n**เพิ่มมูลค่า:** 50,000-150,000 บาท\n\n**ทำไมคุ้ม:**\n* ทำให้ห้องดูสะอาด สดใส ใหม่\n* ต้นทุนต่ำมาก แต่ Impact สูงมาก\n* เปลี่ยนความรู้สึกของห้องได้ทั้งหมด\n\n**Tips:**\n* เลือกสีอ่อนโทนนู้ด สีขาว หรือเทา\n* หลีกเลี่ยงสีเข้มหรือสีฉูดฉาด\n* ใช้สีคุณภาพดีที่ล้างง่าย\n\n### 2. เปลี่ยนหรือซ่อมพื้น - ROI 200-400%\n\n**ต้นทุน:** 20,000-80,000 บาท\n**เพิ่มมูลค่า:** 60,000-200,000 บาท\n\n**ทำไมคุ้ม:**\n* พื้นเป็นสิ่งแรกที่ผู้ซื้อสังเกต\n* พื้นดีทำให้ห้องดูแพงขึ้น\n* พื้นเก่าทำให้ห้องดูรกและไม่น่าอยู่\n\n**ตัวเลือก:**\n* SPC Flooring - ทนทาน ราคาเหมาะสม (250-400 บาท/ตร.ม.)\n* Laminate - ดูดี ราคาไม่แพง (300-500 บาท/ตร.ม.)\n* Vinyl - ถูกที่สุด แต่อายุใช้งานสั้นกว่า\n\n### 3. อัพเกรดห้องน้ำ - ROI 150-300%\n\n**ต้นทุน:** 50,000-150,000 บาท\n**เพิ่มมูลค่า:** 100,000-400,000 บาท\n\n**ทำไมคุ้ม:**\n* ห้องน้ำเป็นปัจจัยสำคัญในการตัดสินใจซื้อ\n* ห้องน้ำเก่าทำให้คนไม่อยากซื้อ\n* ห้องน้ำสวยทำให้ห้องดูหรู\n\n**สิ่งที่ควรทำ:**\n* เปลี่ยนสุขภัณฑ์ให้ใหม่และทันสมัย\n* เปลี่ยนกระเบื้องถ้าเก่ามาก หรือทำ Epoxy Coating ถ้างบจำกัด\n* เปลี่ยนฝักบัวและก๊อกน้ำ\n* เพิ่มแสงสว่างและกระจก\n\n### 4. ปรับปรุงห้องครัว - ROI 100-250%\n\n**ต้นทุน:** 50,000-200,000 บาท\n**เพิ่มมูลค่า:** 80,000-400,000 บาท\n\n**ทำไมคุ้ม:**\n* ห้องครัวเป็นหนึ่งในห้องที่ผู้ซื้อให้ความสำคัญมาก\n* ห้องครัวทันสมัยทำให้คนรู้สึกอยากทำอาหาร\n\n**สิ่งที่ควรทำ:**\n* เปลี่ยนหน้าบานตู้ครัว (ถ้างบน้อย ทาสีใหม่ก็ได้)\n* เปลี่ยน Top เคาน์เตอร์เป็นหินสังเคราะห์\n* เพิ่มไฟใต้ตู้\n* เปลี่ยนอ่างล้างจานให้ใหม่\n\n### 5. เปลี่ยนโคมไฟและเพิ่มแสงสว่าง - ROI 200-400%\n\n**ต้นทุน:** 10,000-30,000 บาท\n**เพิ่มมูลค่า:** 30,000-100,000 บาท\n\n**ทำไมคุ้ม:**\n* แสงสว่างทำให้ห้องดูกว้างและอบอุ่น\n* ห้องมืดทำให้คนรู้สึกไม่สบายใจ\n* เปลี่ยนโคมไฟไม่ยากและไม่แพง\n\n**Tips:**\n* ใช้ LED warm white (3000K) สำหรับบรรยากาศอบอุ่น\n* เพิ่มแสงในมุมมืด\n* ใช้โคมไฟแบบฝัง (Downlight) ให้ห้องดูสะอาดตา\n\n### 6. เปลี่ยนประตูและหน้าต่าง - ROI 80-150%\n\n**ต้นทุน:** 30,000-100,000 บาท\n**เพิ่มมูลค่า:** 50,000-150,000 บาท\n\n**เมื่อไหร่ควรทำ:**\n* ประตูเก่ามาก หรือเสียหาย\n* หน้าต่างไม่สามารถกันเสียงได้\n* มีปัญหาความปลอดภัย\n\n### 7. เพิ่มที่เก็บของ Built-in - ROI 100-200%\n\n**ต้นทุน:** 40,000-120,000 บาท\n**เพิ่มมูลค่า:** 60,000-200,000 บาท\n\n**ทำไมคุ้ม:**\n* คนชอบห้องที่มีที่เก็บของเยอะ\n* ช่วยให้ห้องดูเป็นระเบียบ\n* เป็นจุดขายที่ดี\n\n### 8. ติดตั้งเครื่องปรับอากาศใหม่ - ROI 60-120%\n\n**ต้นทุน:** 15,000-40,000 บาท/เครื่อง\n**เพิ่มมูลค่า:** 20,000-60,000 บาท/เครื่อง\n\n**เมื่อไหร่ควรทำ:**\n* เครื่องแอร์เก่ามากกว่า 8 ปี\n* แอร์มีปัญหาบ่อยๆ\n* แอร์เสียงดังหรือกินไฟมาก\n\n**Tips:**\n* เลือกแบบ Inverter ประหยัดไฟ\n* เลือกยี่ห้อที่มีชื่อเสียง\n\n### 9. ทำความสะอาดอย่างล้ำลึก - ROI 500-1000%\n\n**ต้นทุน:** 3,000-8,000 บาท\n**เพิ่มมูลค่า:** 20,000-80,000 บาท\n\n**ทำไมคุ้มมาก:**\n* ต้นทุนต่ำมาก แต่ผลลัพธ์ดีมาก\n* ห้องสะอาดทำให้ผู้ชมรู้สึกดี\n* สามารถทำเองได้\n\n**สิ่งที่ต้องทำ:**\n* ทำความสะอาดหน้าต่าง กระจก\n* ล้างแอร์ทุกเครื่อง\n* ขัดพื้น เช็ดฝุ่น\n* ทำความสะอาดห้องน้ำให้เป็นประกาย\n\n### 10. Staging - จัดแสดงห้องให้น่าอยู่ - ROI 200-500%\n\n**ต้นทุน:** 10,000-50,000 บาท\n**เพิ่มมูลค่า:** 50,000-200,000 บาท\n\n**ทำไมคุ้ม:**\n* ทำให้ผู้ชมจินตนาการถึงการอยู่ในห้องได้\n* ห้องว่างเปล่าดูเล็กและไม่น่าสนใจ\n* Staging ที่ดีสร้าง Emotional Connection\n\n**Tips:**\n* ใช้เฟอร์นิเจอร์ขนาดเหมาะสม ไม่ใหญ่เกินไป\n* ใช้โทนสีที่ Neutral\n* เพิ่มต้นไม้และของตกแต่งเล็กน้อย\n\n## สิ่งที่ไม่ควรปรับปรุง (ROI ต่ำ)\n\n### 1. ระบบ Smart Home แพงๆ - ROI 20-50%\n**ทำไมไม่คุ้ม:** ส่วนใหญ่ผู้ซื้อไม่เห็นความสำคัญมากพอ\n\n### 2. เฟอร์นิเจอร์ Designer แพงๆ - ROI 10-30%\n**ทำไมไม่คุ้ม:** ผู้ซื้อมักต้องการตกแต่งเอง\n\n### 3. งานโครงสร้างใหญ่ - ROI แตกต่างกันมาก\n**ทำไมไม่คุ้ม:** ถ้าไม่จำเป็นจริงๆ ต้นทุนสูงมากแต่เพิ่มมูลค่าไม่มาก\n\n### 4. เปลี่ยนระบบไฟฟ้าทั้งหมด - ROI 30-60%\n**ทำไมไม่คุ้ม:** ถ้าระบบเดิมใช้งานได้ดี ไม่จำเป็นต้องเปลี่ยน\n\n### 5. ติดตั้งเครื่องใช้ไฟฟ้าราคาแพง - ROI 20-40%\n**ทำไมไม่คุ้ม:** ผู้ซื้อมักเลือกซื้อเครื่องใช้ไฟฟ้าเอง\n\n## กรณีศึกษา: การปรับปรุง 2 แบบ\n\n### กรณีที่ 1: ปรับปรุงแบบประหยัด (งบ 100,000 บาท)\n\n**การใช้จ่าย:**\n* ทาสีใหม่: 25,000 บาท\n* ซ่อมและทำความสะอาดพื้น: 15,000 บาท\n* ซ่อมห้องน้ำ (เปลี่ยนสุขภัณฑ์): 30,000 บาท\n* เปลี่ยนโคมไฟ: 15,000 บาท\n* ทำความสะอาดล้ำลึก: 5,000 บาท\n* Staging: 10,000 บาท\n\n**ผลลัพธ์:**\n* ต้นทุนรวม: 100,000 บาท\n* เพิ่มมูลค่า: 250,000 บาท\n* ROI: 150%\n* เวลา: 2 สัปดาห์\n\n### กรณีที่ 2: ปรับปรุงแบบครบ (งบ 300,000 บาท)\n\n**การใช้จ่าย:**\n* ทาสีใหม่: 30,000 บาท\n* เปลี่ยนพื้นใหม่ทั้งห้อง: 80,000 บาท\n* ปรับปรุงห้องน้ำทั้งหมด: 100,000 บาท\n* ปรับปรุงห้องครัว: 50,000 บาท\n* เปลี่ยนโคมไฟและแอร์: 30,000 บาท\n* Staging: 10,000 บาท\n\n**ผลลัพธ์:**\n* ต้นทุนรวม: 300,000 บาท\n* เพิ่มมูลค่า: 600,000 บาท\n* ROI: 100%\n* เวลา: 1.5-2 เดือน\n\n## เคล็ดลับการปรับปรุงให้ได้ ROI สูง\n\n### 1. เข้าใจกลุ่มเป้าหมาย\nปรับปรุงตามสิ่งที่ผู้ซื้อหรือผู้เช่าต้องการจริงๆ\n\n### 2. จัดลำดับความสำคัญ\nทำสิ่งที่ให้ ROI สูงก่อน ถ้างบหมดก็หยุดได้\n\n### 3. อย่า Over-Improve\nห้ามปรับปรุงจนราคาสูงเกินกว่าตลาดจะรับได้\n\n### 4. ใช้ผู้รับเหมาที่ดี\nช่างที่ดีอาจแพงกว่า แต่ประหยัดเวลาและเงินในระยะยาว\n\n### 5. ควบคุมงบประมาณ\nมีเงินสำรอง 15-20% สำหรับค่าใช้จ่ายที่ไม่คาดคิด\n\n## NextFlip Estate ช่วยคุณอย่างไร?\n\nเรามีบริการครบวงจรสำหรับการปรับปรุงคอนโด:\n\n* **ประเมินและวางแผน** - บอกว่าควรปรับปรุงอะไร ไม่ควรปรับปรุงอะไร\n* **คำนวณ ROI** - วิเคราะห์ผลตอบแทนที่คาดหวัง\n* **จัดหาผู้รับเหมา** - เครือข่ายช่างที่เชื่อถือได้\n* **ควบคุมคุณภาพ** - ตรวจสอบงานทุกขั้นตอน\n* **บริการ Staging** - จัดแสดงห้องให้น่าสนใจ\n* **ช่วยขาย** - ถ่ายภาพและหาผู้ซื้อ\n\n## สรุป\n\nการปรับปรุงคอนโดที่ดีไม่ใช่การทำทุกอย่างให้สวยที่สุด แต่คือการเลือกทำสิ่งที่ให้ผลตอบแทนสูงสุด การทาสี ซ่อมพื้น และปรับปรุงห้องน้ำมักให้ ROI สูงที่สุด ขณะที่การติดตั้งระบบ Smart Home แพงๆ หรือซื้อเฟอร์นิเจอร์ Designer มักไม่คุ้มค่า\n\nหากคุณกำลังคิดจะปรับปรุงคอนโดเพื่อขายหรือให้เช่า NextFlip Estate พร้อมให้คำปรึกษาฟรี และช่วยวางแผนที่จะให้คุณได้ผลตอบแทนสูงสุด\n\nติดต่อเราวันนี้เพื่อรับคำปรึกษาและเริ่มต้นเพิ่มมูลค่าคอนโดของคุณ!\n\n---\n\n*NextFlip Estate - ปรับปรุงอย่างชาญฉลาด ได้ผลตอบแทนสูงสุด*"
  }
]);
    return redirect("/blogs");
  } catch (error) {
    return { error: "ไม่สามารถบันทึกข้อมูลได้ กรุณาลองใหม่อีกครั้ง" };
  }
};

/**
 * CLIENT COMPONENT
 */
export default function BlogAddPage() {
  const actionData = useActionData<typeof action>();

  // Form State สำหรับฟิลด์ทั่วไป
  const [form, setForm] = useState({
    title: "",
    slug: "",
    tags: "",
    author: "",
    content: "",
  });

  // State สำหรับรูปภาพที่เลือกแล้ว
  const [images, setImages] = useState<string[]>([]);

  // Modal & Selection State
  const [isOpen, setIsOpen] = useState(false);
  const [selectedInModal, setSelectedInModal] = useState<string[]>([]);
  const [searchTerm, setSearchTerm] = useState("");

  /** * รายชื่อรูปภาพตัวอย่าง 
   * ในการทำงานจริง คุณอาจจะ fetch จาก API หรือดึงมาจากโฟลเดอร์ public
   */

  const length = 25;

  const arr = Array.from({ length: length }, (_, index) => `/images/condo${index + 1}.jpg`);
  const libraryImages = [
    ...arr
  ];

  const filteredImages = libraryImages.filter(img => img.includes(searchTerm));

  // Auto-generate slug เมื่อ Title เปลี่ยน
  const generateSlug = (title: string) => {
    const base = title
      .toLowerCase()
      .trim()
      .replace(/[^a-z0-9ก-๙]+/g, "-") // รองรับอักษรไทยเบื้องต้น
      .replace(/(^-|-$)+/g, "");
    const shortId = uuidv4().split("-")[0];
    return base ? `${base}-${shortId}` : "";
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
    const { name, value } = e.target;
    if (name === "title") {
      setForm((prev) => ({
        ...prev,
        title: value,
        slug: generateSlug(value),
      }));
    } else {
      setForm((prev) => ({ ...prev, [name]: value }));
    }
  };

  const handleToggleImage = (url: string) => {
    setSelectedInModal(prev =>
      prev.includes(url) ? prev.filter(i => i !== url) : [...prev, url]
    );
  };

  const handleApplyImages = () => {
    setImages(selectedInModal);
    setIsOpen(false);
  };

  return (
    <div className="max-w-4xl mx-auto px-6 py-10">
      <div className="flex items-center justify-between mb-8">
        <h1 className="text-3xl font-bold">Create New Blog</h1>
      </div>

      {actionData?.error && (
        <div className="mb-6 p-4 bg-red-50 border-l-4 border-red-500 text-red-700">
          {actionData.error}
        </div>
      )}

      <Form method="post" className="space-y-8">
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          {/* Title */}
          <div className="space-y-2">
            <label className="text-sm font-semibold uppercase tracking-wider text-gray-500">Title</label>
            <input
              name="title"
              type="text"
              value={form.title}
              onChange={handleChange}
              className="w-full border-b-2 border-gray-200 focus:border-blue-500 outline-none py-2 text-xl transition-colors"
              placeholder="หัวข้อบล็อกของคุณ..."
              required
            />
          </div>

          {/* Slug */}
          <div className="space-y-2">
            <label className="text-sm font-semibold uppercase tracking-wider text-gray-500">Slug</label>
            <input
              name="slug"
              type="text"
              value={form.slug}
              onChange={handleChange}
              className="w-full bg-gray-50 border-b-2 border-gray-200 py-2 text-gray-500 italic outline-none"
              placeholder="auto-generated-slug"
              required
            />
          </div>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          {/* Author */}
          <div className="space-y-2">
            <label className="text-sm font-semibold uppercase tracking-wider text-gray-500">Author</label>
            <input
              name="author"
              type="text"
              value={form.author}
              onChange={handleChange}
              className="w-full border-b-2 border-gray-200 focus:border-blue-500 outline-none py-1 transition-colors"
              placeholder="John Doe"
            />
          </div>

          {/* Tags */}
          <div className="space-y-2">
            <label className="text-sm font-semibold uppercase tracking-wider text-gray-500">Tags</label>
            <input
              name="tags"
              type="text"
              value={form.tags}
              onChange={handleChange}
              className="w-full border-b-2 border-gray-200 focus:border-blue-500 outline-none py-1 transition-colors"
              placeholder="travel, real estate, condo"
            />
          </div>
        </div>

        {/* Image Picker Section */}
        <div className="space-y-4">
          <div className="flex items-center justify-between">
            <label className="text-sm font-semibold uppercase tracking-wider text-gray-500">Blog Images</label>
            <button
              type="button"
              onClick={() => {
                setSelectedInModal(images);
                setIsOpen(true);
              }}
              className="flex items-center gap-2 text-sm bg-zinc-900 text-white px-4 py-2 rounded-full hover:bg-zinc-700 transition"
            >
              <ImageIcon size={16} /> เลือกรูปภาพ ({images.length})
            </button>
          </div>

          {/* Hidden input for server-side processing */}
          <input type="hidden" name="imagesJSON" value={JSON.stringify(images)} />

          {/* Preview list */}
          <div className="grid grid-cols-2 sm:grid-cols-4 gap-4">
            {images.map((url, idx) => (
              <div key={idx} className="relative aspect-video rounded-lg overflow-hidden border bg-gray-100 group">
                <img src={url} className="w-full h-full object-cover" alt="Preview" />
                <button
                  type="button"
                  onClick={() => setImages(images.filter((_, i) => i !== idx))}
                  className="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition"
                >
                  <X size={12} />
                </button>
              </div>
            ))}
          </div>
        </div>

        {/* Markdown Editor */}
        <div className="space-y-2">
          <label className="text-sm font-semibold uppercase tracking-wider text-gray-500">Content</label>
          <MarkdownEditor
            name="content"
            value={form.content}
            onChange={(val) => setForm(p => ({ ...p, content: val }))}
            placeholder="เริ่มเขียนเนื้อหาของคุณที่นี่..."
            minHeight="400px"
          />
        </div>

        <button
          type="submit"
          className="w-full bg-blue-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-blue-700 shadow-lg shadow-blue-200 transition-all"
        >
          Publish Blog Post
        </button>
      </Form>

      {/* SELECTION MODAL */}
      {isOpen && (
        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4">
          <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={() => setIsOpen(false)} />

          <div className="relative bg-white w-full max-w-4xl h-[85vh] rounded-3xl shadow-2xl flex flex-col overflow-hidden">
            <div className="p-6 border-b border-zinc-200 flex items-center justify-between">
              <div>
                <h2 className="text-2xl font-bold">Image Library</h2>
                <p className="text-gray-500 text-sm">เลือกรูปภาพที่ต้องการใช้ในบทความ</p>
              </div>
              <button onClick={() => setIsOpen(false)} className="p-2 hover:bg-gray-100 rounded-full transition">
                <Minus size={24} />
              </button>
            </div>

            <div className="p-6 bg-gray-50 flex-shrink-0">
              <div className="relative">
                <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" size={18} />
                <input
                  type="text"
                  placeholder="Search images by URL..."
                  className="w-full pl-10 pr-4 py-2 input focus:ring-2 focus:ring-blue-500 outline-none"
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                />
              </div>
            </div>

            <div className="flex-1 overflow-y-auto p-6 grid grid-cols-2 md:grid-cols-3 gap-4">
              {filteredImages?.length > 0 ? filteredImages.map((url) => {
                const isSelected = selectedInModal.includes(url);
                return (
                  <div
                    key={url}
                    onClick={() => handleToggleImage(url)}
                    className={`group h-[200px] w-full relative aspect-video rounded-xl overflow-hidden cursor-pointer border-4 transition-all ${isSelected ? "border-blue-500 scale-[0.98]" : "border-transparent hover:border-gray-200"
                      }`}
                  >
                    <img src={url} className="w-full h-full object-cover" alt="Library Item" />
                    {isSelected && (
                      <div className="absolute inset-0 bg-blue-500/20 flex items-center justify-center">
                        <div className="bg-blue-500 text-white rounded-full p-2 shadow-lg">
                          <Check size={20} strokeWidth={3} />
                        </div>
                      </div>
                    )}
                  </div>
                );
              }) :
                searchTerm ? ( // Only show if searchTerm actually exists
                  <div
                    key={searchTerm}
                    onClick={() => handleToggleImage(searchTerm)}
                    className={`group h-[200px] w-full relative aspect-video rounded-xl overflow-hidden cursor-pointer border-4 transition-all ${selectedInModal.includes(searchTerm) // Dynamic highlight
                        ? "border-blue-500 scale-[0.98]"
                        : "border-transparent hover:border-gray-200"
                      }`}
                  >
                    <img src={searchTerm} className="w-full h-full object-cover" alt="Search Result" />

                    {/* Dynamic Checkmark visibility */}
                    {selectedInModal.includes(searchTerm) && (
                      <div className="absolute inset-0 bg-blue-500/20 flex items-center justify-center">
                        <div className="bg-blue-500 text-white rounded-full p-2 shadow-lg">
                          <Check size={20} strokeWidth={3} />
                        </div>
                      </div>
                    )}
                  </div>
                ) : (
                  <div className="col-span-full text-center py-10 text-gray-400">
                    No images found.
                  </div>
                )
              }
            </div>

            <div className="p-6 border-t border-zinc-200 flex items-center justify-between bg-white">
              <span className="text-sm font-medium text-gray-600">
                Selected: {selectedInModal.length} images
              </span>
              <div className="flex gap-3">
                <button
                  type="button"
                  onClick={() => setIsOpen(false)}
                  className="px-6 py-2 text-gray-600 hover:bg-gray-100 rounded-xl transition"
                >
                  Cancel
                </button>
                <button
                  type="button"
                  onClick={handleApplyImages}
                  className="px-8 py-2 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition shadow-md"
                >
                  Apply Selection
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}